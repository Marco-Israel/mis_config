#!/bin/bash


################################################################################
# @brief    Help
################################################################################
_usage() {
cat <<-EOF
                "${0##*/}"
################################################################################

@author     Marco Israel (MI)
@date       2021

  USAGE:
 "${0##*/} <testName>/<testCase> [ -c / --clean ]
    -c / --clean    Remove the old log file. Default: extend the log file

 @example
 "${0##*/} 1.2.3.4_myRequirement/1_my_test_case -c

################################################################################
# END OF HELP.
EOF
}



################################################################################
# @brief    Main
################################################################################
_main(){
    if [ "$1" = "-h" ] || [ "$1" = "--help"]
    then
        _usage
        exit 0
    fi
    PATH_GOLDEN_CERTS=./output/hu/
    PATH_SILVER_CERTS="$1"/output/hu

    FILE_COMPARE_LOG=./certificate_compare.log

    if [ "$2" = "-c" ] || [ "$2" = "--clean" ]
    then
        rm $FILE_COMPARE_LOG
    fi

    echo "GOLDEN certificate path:  $PATH_GOLDEN_CERTS" >> $FILE_COMPARE_LOG
    echo "SILVER certificate path:  $PATH_SILVER_CERTS" >> $FILE_COMPARE_LOG

    CERT_NAMES=("root-ca-1.cert.txt"    \
        "sub-ca-1.cert.txt"             \
        "subscriber-1.cert.txt")

    for (( i = 0; i < ${#CERT_NAMES[@]}; i++ )); do

        echo "" >> $FILE_COMPARE_LOG
        echo "############################################" >> $FILE_COMPARE_LOG
        echo    CERTIFICATES:  ${CERT_NAMES[$i]} >> $FILE_COMPARE_LOG
        echo "############################################" >> $FILE_COMPARE_LOG

        python3 ./tools/certdiff/cert_texdiff.py    \
        $PATH_GOLDEN_CERTS/${CERT_NAMES[$i]}    \
        $PATH_SILVER_CERTS/${CERT_NAMES[$i]} | tee -a $FILE_COMPARE_LOG
    done
}
_main $1 $2

### EOF ########################################################################
