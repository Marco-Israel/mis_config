#!/bin/bash

_usage() {
cat <<-EOF
                "${0##*/}"
################################################################################

@author    Marco Israel (MI)
@date      2021-03
@brief     Mmerge the remote develop branch into your feature branche. Build all
@details   Its a simple script to merge the remote develop branch into your
           current git checkout feature branch. Afterwards it builds, formats
           and lints the code in a batch. You can to take a coffe or tea or
           water or .. in the while of building and linting. (While hoping that
           nothing will break).

@attention  * Make shure you are in your project root directory when calling
                this script (where the .git folder lifes).
            * Make shure you are in your feature branch where you like to merge
                the current up-to-date upstream develop branch into it.

  USAGE:
 "${0##*/}

################################################################################
# END OF HELP.
EOF
}


################################################################################
# @brief    Get the script arguments. (In case you need this in the future=
_getopts() {

        # TODO select only once, depending on how to get the parameters.
    while getopts "h:o:p:" OPT
    do
    	case "$OPT" in
        *)
             _usage
            ;;
    	esac
       shift $((OPTIND -1))
    done
}



################################################################################

git merge origin/develop
rm -rf build
rm -rf staging
rm -rf pclint
mkdir build && cd build
cmake -DCMAKE_BUILD_TYPE=Debug -DCRYPTOSERVICE_ENABLE_COVERAGE=ON .
make -j16 thirdparty && make -j16 && make format-all
cd .. && mkdir pclint && cd pclint
cmake .. && make lint && cat ./pclint/pclint-report.txt && cd ..
