target_sources(${TARGET}
  PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/certificate_compare.cpp)


AUX_SOURCE_DIRECTORY(./golden_certificates CERT_FILES)
foreach(CERT_FILES IN LISTS CERT_SOURCES)
  file(RELATIVE_PATH rs "${CMAKE_CURRENT_SOURCE_DIR}" "${CERT_FILES}")
  get_filename_component(GENERATION_TARGET_DIR ${o} DIRECTORY)
  get_filename_component(BASE_NAME ${CERT_FILES} NAME_WE)
  get_filename_component(CERT_NAME ${CERT_FILES} NAME)
  get_filename_component(CERT_BASE_DIR ${CERT_FILES} DIRECTORY)


  string(TOUPPER "GOLDEN_CERT_HEADER_${BASE_NAME}_H_" INCLUDE_GUARD)
  set(GENERATED_SCHEMA_HEADER "${BASE_NAME}_generated.h")
  add_custom_command(
    COMMAND cd
    ARGS ${CERT_BASE_DIR} && xxd
    ARGS -i
    ARGS "${CERT_NAME}" > "${GENERATED_SCHEMA_HEADER}"
    COMMAND clang-format -style=file -i -fallback-style=none ${GENERATED_SCHEMA_HEADER}
    DEPENDS "${CERT_FILES}"
    COMMENT "Generating cerficate header ${GENERATED_SCHEMA_HEADER} from ${CERT_FILES}"
    VERBATIM)
  list(APPEND PREP_CERT_SOURCES ${GENERATED_SCHEMA_HEADER})

endforeach()

add_custom_target(generate_golden_certificate_headers ALL DEPENDS ${PREP_CERT_SOURCES})
