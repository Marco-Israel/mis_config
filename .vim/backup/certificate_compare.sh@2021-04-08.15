#!/bin/bash

_usage() {
cat <<-EOF
                "${0##*/}"
################################################################################

@author     Marco Israel (MI)
@date       2021

  USAGE:
 "${0##*/} <testName>/<testCase>

 @example
 "${0##*/} 1.2.3.4_myRequirement/1_my_test_case

################################################################################
# END OF HELP.
EOF
}



### MAIN #######################################################################

if [ "$#" -ge  1 ] && [ "$#" -lt 3 ]
then
    PATH_GOLDEN_CERTS=./golden_certificates/output/hu/
    PATH_SILVER_CERTS="$1"/output/hu

    FILE_COMPARE_LOG=./certificate_compare.log

    if [ "$2"= "--rm" ]
    then
        rm $FILE_COMPARE_LOG
    fi

    echo "GOLDEN certificate path:  $PATH_GOLDEN_CERTS" >> $FILE_COMPARE_LOG
    echo "SILVER certificate path:  $PATH_SILVER_CERTS" >> $FILE_COMPARE_LOG

    CERT_NAMES=("root-ca-1.cert.txt"    \
        "sub-ca-1.cert.txt"             \
        "subscriber-1.cert.txt")

    for (( i = 0; i < ${#CERT_NAMES[@]}; i++ )); do

        echo "" >> $FILE_COMPARE_LOG
        echo "############################################" >> $FILE_COMPARE_LOG
        echo    CERTIFICATES:  ${CERT_NAMES[$i]} >> $FILE_COMPARE_LOG
        echo "############################################" >> $FILE_COMPARE_LOG

        python3 ./tools/certdiff/cert_texdiff.py    \
            $PATH_GOLDEN_CERTS/${CERT_NAMES[$i]}    \
            $PATH_SILVER_CERTS/${CERT_NAMES[$i]} >> $FILE_COMPARE_LOG
    done
else
    _usage
fi

### EOF ########################################################################
